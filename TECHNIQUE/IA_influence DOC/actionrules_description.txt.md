NPC ACTION SYSTEM - REFERENCE GUIDE ==================================== This file describes all available actions that NPCs can perform and explains how to add custom rules to the actionrules.txt file to configure AI behavior. TABLE OF CONTENTS: ------------------ 1. What is the action system 2. All available NPC actions 3. How to add custom rules to actionrules.txt 4. Examples of rules 1. WHAT IS THE ACTION SYSTEM ============================= NPCs in AIInfluence can perform various actions: travel across the map, follow the player, attack enemies, besiege settlements, etc. **Multi-tasking actions**: An NPC can perform multiple actions in sequence in one chain. For example, a player can ask an NPC to "visit city A, then city B, attack bandits and return" - and the NPC will complete all these tasks sequentially. Actions are combined with commas, creating a chain of tasks. The actionrules.txt file allows you to add additional instructions for the AI that will be automatically added to the prompt in the "ADDITIONAL RULES FOR ACTIONS" section. This helps adjust AI behavior if it incorrectly uses actions or does something differently than you need. 2. ALL AVAILABLE NPC ACTIONS ============================= 2.1. follow_player ------------------- **What it does**: NPC follows the player, accompanies them **When used**: When the player asks the NPC to travel together or guard them 2.2. go_to_settlement --------------------- **What it does**: NPC travels to the specified settlement (city, castle, village) **When used**: When the player asks the NPC to go to a settlement 2.3. return_to_player --------------------- **What it does**: NPC returns to the player after completing a task **When used**: When the NPC has completed a task and should return to the player 2.4. attack_party ---------------- **What it does**: NPC attacks the specified party (bandits, deserters, enemies) **When used**: When the player orders an attack on a specific party 2.5. patrol_settlement ---------------------- **What it does**: NPC patrols around the specified settlement **When used**: When the player asks to guard a settlement or patrol its surroundings 2.6. wait_near_settlement ------------------------- **What it does**: NPC waits near a settlement without entering it **When used**: When it's necessary to hold position near a settlement 2.7. siege_settlement --------------------- **What it does**: NPC besieges the specified city or castle **When used**: When the player orders to start a siege of a settlement 2.8. raid_village ----------------- **What it does**: NPC raids the specified enemy village **When used**: When the player orders to raid a village 2.9. create_party ----------------- **What it does**: NPC creates their own party (leaves the player's party) **When used**: When the NPC agrees to act independently from the player 2.10. Multi-tasking actions (chains) ------------------------------------- **What it does**: NPC can perform multiple actions in sequence in one chain **When used**: When the player asks to complete several tasks sequentially **Examples of chains**: - Visit multiple settlements: "go to city A, then to city B, then return" - Complete a task and return: "attack bandits and return to me" - Combined tasks: "visit a city, then patrol it, then return" NPCs can combine actions with commas, creating a sequence of tasks that will be completed one after another. 3. DIALOGUE ACTIONS (decision) =============================== 3.1. attack ----------- **What it does**: NPC decides to attack the player **When used**: In critical conflict situations or when the NPC decides to start a fight 3.2. surrender -------------- **What it does**: NPC surrenders to the player **When used**: When the NPC decides to surrender as a prisoner due to weakness of their forces 3.3. accept_surrender --------------------- **What it does**: NPC accepts the player's surrender as a prisoner **When used**: When the player offers to surrender and the NPC agrees 3.4. release ------------ **What it does**: NPC releases the player peacefully (does not attack) **When used**: When the NPC decides not to attack the player and lets them go 3.5. propose_marriage --------------------- **What it does**: NPC proposes marriage to the player **When used**: When the NPC wants to marry the player 3.6. accept_marriage -------------------- **What it does**: NPC accepts the player's marriage proposal **When used**: When the player proposes marriage and the NPC agrees 3.7. reject_marriage --------------------- **What it does**: NPC rejects a marriage proposal **When used**: When the player proposes marriage, but the NPC refuses 3.8. intimate --------------------- **What it does**: Intimate interaction with NPCs **When used**: AI sets the "intimate" option when it agrees to sex. A child may be conceived during the process. 4. FINANCIAL ACTIONS ==================== 4.1. money_transfer ------------------- **What it does**: Money transfer between NPC and player **When used**: When the NPC agrees to give or receive money from the player **Important**: Used only when the NPC AGREES to transfer money, not for offers or refusals 5. WORKSHOP ACTIONS =================== 5.1. workshop_action (sell) ---------------------------- **What it does**: NPC sells their workshop to the player **When used**: When the NPC agrees to sell the workshop after price negotiations **Important**: Used only after final price agreement, not during negotiations 6. DIPLOMATIC ACTIONS (kingdom_action) ====================================== Available only to kingdom rulers and vassals in certain situations. 6.1. declare_war ----------------- **What it does**: Declaration of war on another kingdom **When used**: When a ruler decides to declare war 6.2. propose_peace / accept_peace / reject_peace ------------------------------------------------- **What it does**: Peace proposal, acceptance or rejection of a peace proposal **When used**: To end or continue a war 6.3. propose_alliance / accept_alliance / reject_alliance / break_alliance --------------------------------------------------------------------------- **What it does**: Alliance proposal, acceptance, rejection or breaking of an alliance **When used**: To create or break alliances between kingdoms 6.4. propose_trade_agreement / accept_trade_agreement / reject_trade_agreement / end_trade_agreement ------------------------------------------------------------------------------------------------------ **What it does**: Trade agreements between kingdoms **When used**: To establish or terminate trade relations 6.5. demand_territory / transfer_territory ------------------------------------------- **What it does**: Demand or transfer of territory (city/castle) **When used**: In diplomatic negotiations about territories 6.6. demand_tribute / accept_tribute / reject_tribute ------------------------------------------------------ **What it does**: Demand for daily tribute, acceptance or rejection of the demand **When used**: To establish economic conditions for peace 6.7. demand_reparations / accept_reparations / reject_reparations ----------------------------------------------------------------- **What it does**: Demand for one-time reparations, acceptance or rejection **When used**: To compensate for war damage 7. RECRUITMENT ACTIONS (kingdom_action) ======================================= 7.1. hire_mercenary ------------------- **What it does**: Hiring the player as a mercenary **When used**: When a ruler or vassal hires the player for service **Available**: To kingdom rulers and vassals (vassals hire on behalf of the kingdom) 7.2. dismiss_mercenary ----------------------- **What it does**: Dismissal of the player from mercenaries **When used**: When a ruler dismisses the player or the player asks to be dismissed **Available**: Only to kingdom rulers 7.3. offer_vassalage -------------------- **What it does**: Offer to the player to become a vassal **When used**: When a ruler offers vassalage to the player **Available**: Only to kingdom rulers 7.4. dismiss_vassal -------------------- **What it does**: Release of the player from vassalage **When used**: When a ruler releases the player or the player asks for it **Available**: Only to kingdom rulers 7.5. join_player_clan --------------------- **What it does**: NPC joins the player's clan as a companion **When used**: When the player invites the NPC to their clan and the NPC agrees 7.6. join_player_kingdom ------------------------ **What it does**: NPC's clan joins the player's kingdom **When used**: When the player (as a ruler) invites the NPC's clan and the NPC agrees 7.7. hire_mercenary_clan ------------------------ **What it does**: NPC's clan accepts the player's offer to hire them as mercenaries **When used**: When the player (as a ruler) offers to hire the NPC's clan and the NPC agrees 7.8. kick_from_clan ------------------- **What it does**: NPC accepts the player's decision to dismiss them from the clan **When used**: When the player dismisses the NPC from their clan or the NPC asks to be dismissed 7.9. dismiss_npc_mercenary --------------------------- **What it does**: NPC's clan accepts the player's decision to dismiss them from mercenaries **When used**: When the player (as a ruler) dismisses the NPC's clan or the NPC asks to be dismissed 7.10. release_npc_vassal ------------------------- **What it does**: NPC's clan accepts the player's decision to release them from vassalage **When used**: When the player (as a ruler) releases the NPC's clan or the NPC asks to be released 8. HOW TO ADD CUSTOM RULES TO actionrules.txt ============================================== 8.1. Creating the file ---------------------- 1. Find the AIInfluence mod folder (usually in `Modules/AIInfluence/`) 2. Create a text file named `actionrules.txt` in the root of the mod folder 3. Add your rules to this file (in English) 8.2. Rule format ----------------- Rules are written in English in free form. They will be automatically added to the "ADDITIONAL RULES FOR ACTIONS" section of the AI prompt. Rules should be written as instructions for the AI, explaining: - When to use or NOT use certain actions - What checks to perform before using actions - How to consider NPC personality when making decisions - Additional restrictions or conditions 8.3. Rule writing style ------------------------ - Use imperative form ("NPC should...", "Always verify...", "Never use...") - Be specific and clear - Specify specific actions and conditions - Can reference NPC personality ("Consider personality when...") - Can add example situations **Good rule examples**: ``` - NPC should always verify settlement information is provided in the prompt before using go_to_settlement action. If settlement details are missing, NPC should say "I don't know which settlement you mean" and NOT use the action. - NPC with high honor trait should refuse to raid friendly or neutral villages, even if player orders it. They should explain their refusal based on their principles. - NPC should never attack settlements that belong to their own kingdom or allied kingdoms, even if player suggests it. - When player asks NPC to attack a party, NPC must verify the party information is provided. If information is missing, NPC should role-play uncertainty and NOT use attack_party action. - NPC should prefer returning to player after completing tasks unless explicitly told otherwise by the player. ``` **Bad rule examples** (too general): ``` - NPC should be careful - Don't do bad things - Think before acting ``` 8.4. When to use custom rules ------------------------------ Use custom rules if: - AI uses certain actions too frequently - AI uses actions incorrectly (e.g., attacks friendly settlements) - AI uses actions without necessary information - You want to change action priorities for NPCs - Need to add additional restrictions or conditions - AI doesn't consider NPC personality when making decisions 9. EXAMPLES OF RULES FOR DIFFERENT SITUATIONS ============================================== 9.1. Rules for information verification ---------------------------------------- If AI uses actions without checking necessary information: ``` - CRITICAL: Before using any action that requires settlement or party information (go_to_settlement, attack_party, patrol_settlement, siege_settlement, raid_village, wait_near_settlement), NPC MUST verify that the necessary information is provided in the prompt. If information is missing or unknown, NPC should stay in character, express uncertainty, and NOT use the action. - NPC should never guess or invent information. Only use actions when the necessary details are clearly available in the prompt. ``` 9.2. Rules for considering NPC personality ------------------------------------------- If AI doesn't consider NPC personality: ``` - NPC with high honor trait should refuse to raid villages unless they are clearly enemy villages. They should explain their refusal based on honor and principles. - NPC with cruel trait is more likely to agree to raid villages, but should still verify the target is an enemy. - NPC with calculating trait should consider the strategic value and risks before agreeing to siege_settlement or attack_party actions. - NPC with generous trait should be more willing to help player with follow_player and return_to_player actions. ``` 9.3. Rules for preventing errors --------------------------------- If AI attacks friendly targets: ``` - NPC should NEVER use attack_party, siege_settlement, or raid_village actions against targets that belong to their own kingdom, allied kingdoms, or friendly factions. Always check the faction relationship before using combat actions. - NPC should verify the target settlement's faction status before using siege_settlement. If the settlement belongs to an ally or neutral faction, NPC should refuse and explain why. - NPC should never raid villages that belong to their own kingdom or allied kingdoms, even if player orders it. ``` 9.4. Rules for improving return logic -------------------------------------- If NPC doesn't return after tasks: ``` - NPC should return to player when player explicitly asks them to return after completing a task. Examples: "go there and come back", "visit that place and return to me", "do this and then come back". - NPC should prefer returning to player after completing independent tasks (go_to_settlement, attack_party, patrol_settlement) unless player explicitly says they don't need to return. - NPC should NOT return if player says "go there and stay" or "do this and remain there". ``` 9.5. Rules for limiting action frequency ---------------------------------------- If AI uses certain actions too frequently: ``` - NPC should not use create_party action unless player explicitly asks them to act independently or create their own party. Simply agreeing to do a task does not mean NPC should create a party. - NPC should not use follow_player action unless player explicitly asks them to travel together, guard them, or accompany them. Casual conversation does not require following. - NPC should not automatically return to player after every task. Only use return_to_player when it makes sense based on the conversation context. ``` 9.6. Rules for multi-tasking actions ------------------------------------- If NPC doesn't use action chains correctly: ``` - When player gives NPC a multi-step task (e.g., "visit town A, then town B, then attack bandits and return"), NPC should construct the action chain correctly using commas to separate actions. NPC must verify ALL necessary information is available before using the action chain. - NPC can combine multiple actions in technical_action field by separating them with commas. For example: "go_to_settlement:town_A:2,town_B:3,attack:party_bandits,then:return" means: visit town A and wait 2 days, then visit town B and wait 3 days, then attack bandits, then return to player. - NPC should use ",then:return" modifier at the END of the action chain if player explicitly asks them to return after completing all tasks. - NPC should verify all settlements and parties in a multi-step chain have the necessary information available before using the action. ``` 9.7. Rules for financial actions --------------------------------- If NPC incorrectly uses money_transfer: ``` - NPC should use money_transfer ONLY when they actually AGREE to give or receive money. Do NOT use it for offers, negotiations, or refusals. - NPC should consider their personality when deciding on money transfers. Generous NPCs are more likely to give money, while greedy NPCs are less likely to give and more likely to ask for higher amounts. - NPC should verify the amount is reasonable based on their wealth and the situation before agreeing to money_transfer. ``` 9.8. Rules for diplomatic actions ---------------------------------- If NPC incorrectly uses kingdom_action: ``` - NPC should use kingdom_action ONLY when they are a kingdom leader or vassal, and the action is appropriate for their role. - NPC should NEVER use multiple kingdom_actions unless they are clearly related and make sense together (e.g., peace + territory transfer). - NPC should verify all required parameters are provided before using diplomatic actions (settlement_id for territory actions, amounts for tribute/reparations, etc.). - NPC should consider the diplomatic consequences before using declare_war, break_alliance, or other major diplomatic actions. ``` 9.9. Rules for recruitment actions ----------------------------------- If NPC incorrectly uses recruitment actions: ``` - NPC should use recruitment actions (hire_mercenary, offer_vassalage, join_player_clan, etc.) ONLY when player explicitly asks AND NPC agrees in the dialogue. - NPC should NOT use these actions if they are unsure, need to think about it, or are declining the offer. - NPC should consider their current situation (are they already serving someone, do they have obligations, etc.) before using join_player_clan or join_player_kingdom. - NPC should use dismiss actions (kick_from_clan, dismiss_mercenary, etc.) ONLY when player explicitly dismisses them OR they explicitly request to leave AND player agrees. ``` 9.10. Complex rules -------------------- Examples of more complex rules: ``` - NPC should consider their current task status. If NPC is already performing an action (shown in "Your Current Task" section), they should complete it first before starting a new one, unless player explicitly orders them to stop. - NPC with low trust in player should be more cautious about accepting dangerous tasks like siege_settlement or raid_village. They might ask for clarification or express concerns. - NPC should never use actions that contradict their personality. For example, a cautious NPC should hesitate before agreeing to attack_party against a strong enemy, and a honorable NPC should refuse to raid neutral villages. - NPC should verify all required information is available before using any action that requires specific details (settlements, parties, amounts, etc.). If information is missing, NPC should stay in character and NOT use the action. ``` 10. IMPORTANT NOTES =================== 10.1. Rule language ------------------- - Rules must be written in ENGLISH, as AI prompts are in English - Use clear and precise English - Avoid complex constructions and ambiguities 10.2. Rule structure -------------------- - Each rule can be on a separate line or in paragraph form - Can use bullet lists (with dashes or asterisks) - Can use numbered lists for step sequences - Empty lines between rules improve readability 10.3. Testing rules -------------------- - After adding rules to actionrules.txt, they are automatically loaded on the next dialogue - Check AI behavior in the game - If rules don't work, try reformulating them more clearly - Can add multiple rules for one problem 10.4. Debugging ---------------- - If AI continues to make errors, check mod logs (mod_log.txt) - Make sure rules are written in English - Try making rules more specific and directive - Can add example situations to rules for better AI understanding 11. FREQUENTLY ASKED QUESTIONS ============================== **Q: Where is the actionrules.txt file located?** A: In the root of the AIInfluence mod folder (usually `Modules/AIInfluence/actionrules.txt`) **Q: Do I need to restart the game after changing actionrules.txt?** A: No, the file is automatically re-read on each dialogue. Just save the file. **Q: How many rules can I add?** A: There are no limits, but try not to make the file too large (recommended up to 100-200 lines). **Q: Do rules work for all NPCs?** A: Yes, rules apply to all NPCs in the game. **Q: Can I disable rules?** A: Yes, simply delete or comment out rules in the file, or delete the actionrules.txt file itself. **Q: How to check if rules loaded?** A: Rules are automatically added to the prompt. If AI changed behavior according to rules, they are working. You can also check mod logs for loading errors. CONCLUSION ========== The actionrules.txt file is a powerful tool for configuring AI behavior when using actions. By adding custom rules, you can: - Fix problems with incorrect action usage - Add additional checks and restrictions - Improve consideration of NPC personality when making decisions - Customize AI behavior to your preferences Remember: - Rules must be in English - Be specific and clear - Test rules in the game - Don't be afraid to experiment and adjust rules Happy configuring!