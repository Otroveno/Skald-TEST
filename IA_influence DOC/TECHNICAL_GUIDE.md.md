# ğŸ”§ AI Influence â€” Technical Guide Short description of the mod files and how to work with them. --- ## ğŸ“ File Structure ``` AIInfluence DEV/ â”œâ”€â”€ world.txt # World description for the AI â”œâ”€â”€ world_secrets.json # NPC secrets â”œâ”€â”€ world_info.json # General information â”œâ”€â”€ quirks.json # Speech quirks â”œâ”€â”€ cultural_traditions.json # Romantic traditions â”‚ â”œâ”€â”€ save_data/ # Save data â”‚ â””â”€â”€ [CAMPAIGN_ID]/ # Campaign folder â”‚ â”œâ”€â”€ NPC (id).json # Context for each NPC â”‚ â”œâ”€â”€ dynamic_events.json # Active dynamic events â”‚ â”œâ”€â”€ diplomatic_statements.json # Rulers' statements â”‚ â”œâ”€â”€ alliances.json # Kingdom alliances â”‚ â”œâ”€â”€ war_statistics.json # War statistics â”‚ â”œâ”€â”€ diplomatic_events.json # Active diplomatic events â”‚ â”œâ”€â”€ pending_player_statements.json # Pending player statements â”‚ â”œâ”€â”€ trade_agreements.json # Trade agreements â”‚ â”œâ”€â”€ territory_transfers.json # Territory transfer history â”‚ â”œâ”€â”€ tributes.json # Tribute agreements â”‚ â””â”€â”€ reparations.json # Reparations between kingdoms â”‚ â””â”€â”€ logs/ # Logs â”œâ”€â”€ mod_log.txt â”œâ”€â”€ diplomacy.txt â””â”€â”€ dynamicEvents.log ``` --- ## ğŸŒ `world.txt` **What:** Calradia world description for the AI. **Why:** The AI reads it on every dialogue for context. **How to edit:** - Add your lore in the section "Additional Information About Calradia:" - Use `{Character}` and `{Player}` instead of specific names - Write in English - Save â†’ the file will be hotâ€‘reloaded automatically --- ## ğŸ” `world_secrets.json` **What:** Secret knowledge that NPCs may know. **Format:** ```json [ { "id": "unique_id", "description": "Description for the AI", "knowledgeChance": 50, "applicableNPCs": ["lords"], "accessLevel": "high", "tags": ["optional"] } ] ``` **How it works:** 1. On first interaction, a 0â€“100 roll is made 2. If â‰¤ `knowledgeChance` â†’ the NPC learns the secret 3. The secret is added to the prompt: `"Secrets: ... (access: high)"` 4. The AI decides whether to reveal it (depends on trust) **Important:** Use `knowledgeChance`, NOT `usageChance`! --- **Fields:** - `id` â€” unique name - `description` â€” full text (passed into the AI prompt) - `knowledgeChance` â€” 0â€“100 chance that the NPC learns it on first contact - `applicableNPCs` â€” types: `all`, `lords`, `companions`, `faction_leaders`, `village_notables`, `merchants` - `accessLevel` â€” `low`, `medium`, `high` (shown in the prompt) - `tags` â€” for organization (does not affect logic) ## ğŸ“° `world_info.json` **What:** Public, nonâ€‘secret information. **Format:** ```json [ { "id": "unique_id", "description": "Description (you can use {character})", "usageChance": 75, "applicableNPCs": ["all"], (types: `all`, `lords`, `companions`, `faction_leaders`, `village_notables`, `merchants`) "category": "world" } ] ``` **Fields:** - `usageChance` â€” 0â€“100 chance (works like knowledgeChance) - `category` â€” `world` (persistent), `event` (temporary), `personal` (personal) **Differences from secrets:** - Field: `usageChance` vs `knowledgeChance` - Classification: `category` vs `accessLevel` - In the prompt: "General Info: ..." vs "Secrets: ... (access: high)" --- ## ğŸ—£ï¸ `quirks.json` **What:** List of speech quirks for NPCs. **Format:** ```json [ "speaks briefly and avoids unnecessary words", "uses hunting, battle, or military analogies", "questions others like a quiet interrogator" ] ``` **How it works:** - An NPC gets 1â€“2 random quirks at creation - They are added to the prompt: `"Speech Quirks: ..."` - The AI uses them to shape speaking style **Customization:** Just add strings to the array. --- ## ğŸ’• `cultural_traditions.json` **What:** Romantic traditions per culture. **Format:** ```json { "Aserai": "Description of romantic traditions...", "Battania": "..." } ``` **Affects:** Flirt style and relationship requirements. --- ## ğŸ’¾ NPC Files: `save_data/[CAMPAIGN_ID]/Name (id).json` **Main fields:** | Field | What it does | Can edit | |------|--------------|----------| | `CharacterDescription` | Personality description | âœ… YES | | `KnownSecrets` | Known secrets | âœ… YES (sets a flag) | | `KnownInfo` | Known information | âœ… YES (sets a flag) | | `ConversationHistory` | Dialogue history | âŒ Automatic | | `DynamicEvents` | Known events | âŒ Automatic | | `Quirks` | Speech quirks | âš ï¸ Will be overwritten | You can also see service fields: - `KnownSecretsUserEdited` / `KnownInfoUserEdited` â€” flags that knowledge was edited by the user (if `true`, the system will no longer change these arrays) - `DynamicEvents` / `LastEventAnalysisMessageIndex` â€” which dynamic events the NPC knows and which messages were already sent for analysis - `AIGeneratedPersonality` / `AIGeneratedBackstory` â€” autoâ€‘generated personality and backstory description - Romance fields (`RomanceLevel`, `LastRomanceInteractionDays`, `IsRomanceEligible`) and battle fields (`SettlementCombatInfo`) â€” managed only by the system **Recommendation:** if you do not fully understand a service field, do not edit it â€” you may break the system. **Editing knowledge:** After changing `KnownSecrets` or `KnownInfo`: ```json "KnownSecrets": ["My_Custom_Secret"], "KnownSecretsUserEdited": false // â† Will automatically become true ``` The `UserEdited: true` flag â†’ the system will not touch this field. **Resetting flags:** MCM â†’ NPC Management â†’ Reset Userâ€‘Edited Knowledge --- ## ğŸ“‹ `dynamic_events.json` **What:** Active world events. **Important fields:** - `type` â€” `military`, `political`, `economic`, `social`, `mysterious` - `importance` â€” 1â€“10 (how important) - `kingdoms_involved` â€” array of kingdom `string_id` - `allows_diplomatic_response` â€” whether rulers can make statements - `expiration_campaign_days` â€” when it expires Additionally, events have: - `id` â€” unique event identifier (string, NPCs store knowledge about it in `DynamicEvents`) - `player_involved` â€” whether the player participated - `spread_speed` â€” how fast it spreads **NPC link:** The list of NPCs who know about an event is stored in each `NPC (id).json` in the `DynamicEvents` array. `DynamicEventsManager` automatically updates these fields and removes expired events from NPCs. **Editing:** Not recommended (managed automatically). --- ## ğŸ’¬ `diplomatic_statements.json` **What:** Kingdom rulers' statements. **Structure:** ```json { "kingdom_id": "battania", "statement_text": "Statement text", "action": "None/DeclareWar/ProposePeace/...", "target_kingdom_id": "khuzait", "reason": "Reason", "event_id": "event this statement refers to" } ``` **Storage:** Last 15 statements over 50 inâ€‘game days. **Editing:** Not needed (automatic system). --- ## ğŸ¤ Additional Diplomacy Files All files below are in `save_data/[CAMPAIGN_ID]/` and are managed automatically by the diplomacy system. - `diplomatic_events.json` â€” active diplomatic events linked to dynamic events (`DynamicEvents`) - `pending_player_statements.json` â€” deferred player statements to be published later - `trade_agreements.json` â€” current trade agreements between kingdoms - `territory_transfers.json` â€” history of fief transfers between kingdoms - `tributes.json` â€” tribute payment agreements - `reparations.json` â€” reparations data (history and open claims) **Rule:** all these files are intended for automatic system operation. Edit only if you clearly understand the consequences (for debugging); always make a backup first. ## ğŸ“Š Logs ### `logs/mod_log.txt` â€” main log - Mod initialization - Config loading - AI prompts and responses - API errors **Check when:** - NPC does not respond - Secrets are not loaded - Inâ€‘game errors occur ### `logs/diplomacy.txt` â€” diplomacy - Diplomacy system initialization - Creation of diplomatic situations and statements - Analysis of diplomatic events (full prompts and AI responses) - Executing actions (wars, peace, alliances, relation changes) - Diplomacy system errors and warnings ### `logs/dynamicEvents.log` â€” dynamic events - Event generation (including full prompt and AI response with detailed debugging on) - Event propagation to NPCs (who learned what and why) - Deletion of expired events and cleanup of NPC knowledge --- ## ğŸ› ï¸ Common Tasks ### Add a secret 1. Open `world_secrets.json` 2. Add an object to the array: ```json { "id": "My_Secret", "description": "Secret text here", "knowledgeChance": 100, "applicableNPCs": ["lords"], "accessLevel": "high", "tags": [] } ``` 3. Save â†’ hotâ€‘reloaded automatically ### Give a secret to a specific NPC 1. Open `save_data/[ID]/NPC_name (id).json` 2. Find `KnownSecrets` 3. Add the secret ID: ```json "KnownSecrets": ["My_Secret", "Another_Secret"] ``` 4. Save â†’ the `UserEdited` flag will be set automatically. If for some reason it is not, set it manually. ### Change an NPC's personality 1. Open the NPC file 2. Edit: ```json "CharacterDescription": "Your personality description", ``` 3. Save ### Find the campaign ID 1. Open `logs/mod_log.txt` 2. Find the line: ``` Created save directory: ...\save_data\b7ed0c2f2399 ^^^^^^^^^^^^ ID ``` Or: MCM â†’ Debug â†’ Show Save Folder Info ### Reset NPC data **Option 1:** Delete all - MCM â†’ NPC Management â†’ Clear Current Campaign NPC Data **Option 2:** Delete one - MCM â†’ NPC Management â†’ Erase Specific NPC **Option 3:** Manually - Delete the file `save_data/[ID]/NPC_name.json` ``` --- ## âš ï¸ Important Rules ### JSON files âœ… Always validate JSON (jsonlint.com) âœ… Make backups before editing âœ… Do not delete required fields âŒ Do not edit `dynamic_events.json` and `diplomatic_statements.json` unless necessary ### Secrets vs Info - `world_secrets.json` â†’ field `knowledgeChance` - `world_info.json` â†’ field `usageChance` - **DO NOT CONFUSE THEM!** Otherwise the value will be treated as 0. ### Hot Reload These files are hotâ€‘reloaded automatically: - âœ… `world.txt` - âœ… `world_secrets.json` - âœ… `world_info.json` - âœ… `quirks.json` - âœ… `cultural_traditions.json` NPC files are reloaded on the next interaction. ### Edit Flags If you edit `KnownSecrets` or `KnownInfo`: - The `UserEdited` flag automatically becomes `true` - The system will no longer touch these fields - Reset: MCM â†’ Reset Userâ€‘Edited Knowledge --- ## ğŸ”„ Workflow ### Adding new content 1. **Come up with an idea** (secret, event, quest) 2. **Add it to JSON** (`world_secrets.json` or `world_info.json`) 3. **Save the file** â†’ hotâ€‘reload 4. **Create new NPCs** or reset existing ones 5. **Start a dialogue** â†’ the AI will know about the new content ### Testing secrets 1. Add a secret with `knowledgeChance: 100` 2. Create a new NPC or reset an existing one 3. Start a dialogue 4. Check the log: `[NPC] Name learned secret: ...` 5. Ask the NPC about the secret directly ### Debugging events 1. Enable detailed logging (MCM) 2. Create an event (Force Generate Event) 3. Check `logs/dynamicEvents.log` 4. See who received the event and why --- ## ğŸ“Œ Cheat Sheet ### NPC types for `applicableNPCs` ``` "all" â€” everyone "lords" â€” lords "companions" â€” companions "faction_leaders" â€” rulers "village_notables" â€” village notables "merchants" â€” merchants ``` ### Event types ``` "news" â€” important news "political" â€” diplomacy "military" â€” wars, battles "economic" â€” trade "local" â€” local "rumor" â€” rumors ``` ### Diplomatic actions ``` "None" â€” statement only "DeclareWar" â€” declare war "ProposePeace" â€” propose peace "AcceptPeace" â€” accept peace "RejectPeace" â€” reject peace "ProposeAlliance" â€” propose alliance "AcceptAlliance" â€” accept alliance "RejectAlliance" â€” reject alliance "BreakAlliance" â€” break alliance ``` --- ## ğŸ¯ Key Differences | Aspect | Secrets | Info | |--------|---------|------| | **File** | `world_secrets.json` | `world_info.json` | | **Chance field** | `knowledgeChance` | `usageChance` | | **Classification** | `accessLevel` + `tags` | `category` | | **Purpose** | Secrets, require trust | Public information | ---